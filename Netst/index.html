<!DOCTYPE html>
<html lang="en" data-theme="luxury">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Internet SpeedTest | @BN_LOS</title>
  <link href="https://cdn.jsdelivr.net/npm/daisyui@4.12.14/dist/full.min.css" rel="stylesheet" type="text/css" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .return-btn {
        position: fixed;
        top: 16px;
        left: 16px;
    }

</style>
</head>
<body class="h-screen flex flex-col items-center justify-center">
    <div class="return-btn">
        <a href=".." class="btn btn-outline">‚Üê Return</a>
    </div>

  <div class="absolute top-4 right-4">
    <label for="unit" class="text-xl">Select Unit</label>
    <select id="unit" class="select select-bordered w-32 mt-1">
      <option value="KB/s">KB/s</option>
      <option value="Mbps">Mbps</option>
      <option value="MB/s" selected>MB/s</option>
      <option value="GB/s">GB/s</option>
    </select>
  </div>

  <div class="text-center">
    <h1 class="text-3xl font-semibold mb-6">Internet Speed Test</h1>
    <div class="card w-96 shadow-lg p-6">
      <div class="mb-4">
        <button id="startTest" class="btn btn-outline w-full">Begin </button>
      </div>

      <div id="result" class="text-xl font-bold text-gray-800">
        <p id="downloadSpeed">Download Speed: --</p>
        <p id="uploadSpeed">Upload Speed: --</p>
        <div id="progress" class="radial-progress" style="--value: 0; --size: 12rem; --thickness: 2px;" role="progressbar">
          0%
        </div>
      </div>
    </div>
  </div>

  <script>
    let downloadInterval;
    let uploadInterval;

    function startDownloadSpeedTest() {
      const testUrl = 'https://testfile.xyz/wp-content/uploads/10GB.zip';
      const startTime = Date.now();
      const xhr = new XMLHttpRequest();
      xhr.open('GET', testUrl, true);
      xhr.responseType = 'blob';

      xhr.onloadstart = function () {
        document.getElementById('progress').style.setProperty('--value', 0);
      };

      xhr.onprogress = function (event) {
        if (event.lengthComputable) {
          const elapsedTime = (Date.now() - startTime) / 1000;
          const loadedSize = event.loaded / 1024;
          const speedKBps = loadedSize / elapsedTime;

          updateSpeed('downloadSpeed', speedKBps);
          const progress = (event.loaded / event.total) * 100;
          document.getElementById('progress').style.setProperty('--value', progress);
        }
      };

      xhr.onloadend = function () {
        clearInterval(downloadInterval);
      };

      xhr.send();
    }

    function startUploadSpeedTest() {
      const testUrl = 'https://httpbin.org/post';
      const data = new FormData();
      data.append('file', new Blob([new ArrayBuffer(1000000)]));

      const startTime = Date.now();
      const xhr = new XMLHttpRequest();
      xhr.open('POST', testUrl, true);

      xhr.upload.onprogress = function (event) {
        if (event.lengthComputable) {
          const elapsedTime = (Date.now() - startTime) / 1000;
          const uploadedSize = event.loaded / 1024;
          const speedKBps = uploadedSize / elapsedTime;

          updateSpeed('uploadSpeed', speedKBps);
        }
      };

      xhr.onloadend = function () {
        clearInterval(uploadInterval);
      };

      xhr.send(data);
    }

    function updateSpeed(id, speedKBps) {
      const unit = document.getElementById('unit').value;
      let speed = speedKBps;

      switch (unit) {
        case 'KB/s':
          break;
        case 'Mbps':
          speed *= 8 / 1024;
          break;
        case 'MB/s':
          speed /= 1024;
          break;
        case 'GB/s':
          speed /= (1024 * 1024);
          break;
      }

      document.getElementById(id).textContent = `${id === 'downloadSpeed' ? 'Download' : 'Upload'} Speed: ${speed.toFixed(2)} ${unit}`;
    }

    document.getElementById('startTest').addEventListener('click', function () {
      startDownloadSpeedTest();
      startUploadSpeedTest();
    });
  </script>
  
</body>
</html>
